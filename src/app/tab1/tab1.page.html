<!-- Basic -->
<!-- There is a list of the next features and bug fixes to implement:
- move all UI components inside of the collapsable panel
- initial state of the search is empty with only add filter button "+" visible and drop-down selector of saved presets
- add clear filter button that removes all filters and turns search panel to initial state
- "+" button should insert filter before the current filter. additional "+" button should be in the very bottom of filters list that adds a filter after all current
- track and check user input and remember if anything was actually changed in filters
- if filters was changed, then show user a confirmation before clearing filters or loading another saved preset
- sometimes click on save button is ignored even if the name of preset is set - debug and fix
- do not save empty filter preset, preset name should be 1+ char long
- if user tries to save preset with the same name - ask for confirmation
- remove a line that changes color when you enter text field in the very bottom of the filters list -->
<ion-content [fullscreen]="true" class="content">
  <ion-accordion-group class="accordion-grp">
    <ion-accordion value="colors" class="accordion">
      <ion-item slot="header">
        <ion-label class="accordion-label">Search</ion-label>
      </ion-item>
      <ion-list slot="content" class="list">
        <div
          *ngIf="preSelectList.length > 0 else emptyList"
          class="search-row search-row-select"
        >
          <div class="select-search">
            <div class="select-item">
              <select
                class="select-class"
                [(ngModel)]="presetSelected"
                (change)="onPreselectDDLChange($event)"
              >
                <option class="select-options" value="" selected>
                  Presets
                </option>
                <option
                  class="select-options"
                  [value]="pre?.id"
                  *ngFor="let pre of preSelectList; let i2 = index"
                >
                  {{pre?.filterName}}
                </option>
              </select>
            </div>
          </div>
          <div class="save-btn1">
            <ion-button
              class="plus-button"
              *ngIf="allSearch()?.controls && allSearch()?.controls.length === 0"
              (click)="addRow(true)"
            >
              <ion-icon
                slot="icon-only"
                src="../../assets/icon/dots.svg"
              ></ion-icon>
            </ion-button>
          </div>
        </div>
        <ng-template #emptyList>
          <div class="no-saved-presets">
            <div class="save-btn1">
              <ion-button
                class="plus-button"
                *ngIf="allSearch()?.controls && allSearch()?.controls.length === 0"
                (click)="addRow(true)"
              >
                <ion-icon
                  slot="icon-only"
                  src="../../assets/icon/dots.svg"
                ></ion-icon>
              </ion-button>
            </div>
            <div>
              <ion-text class="no-presets"> No saved Presets </ion-text>
            </div>
          </div>
        </ng-template>
        <ion-row class="search-box"></ion-row>

        <ion-grid
          class="form-wrapper"
          style="overflow: overlay; height: 100vh"
          *ngIf="allSearch()?.controls?.length > 0"
        >
          <form class="" [formGroup]="searchFilterForm">
            <div formArrayName="search">
              <ion-grid
                cdkDropList
                (cdkDropListDropped)="drop($event)"
                class="example-list"
              >
                <ion-row
                  cdkDrag
                  *ngFor="let quantity of allSearch()?.controls; let i = index"
                  [formGroupName]="i"
                  class="example-box"
                >
                  <ion-item class="bcd" lines="none">
                    <ion-row class="abc">
                      <ion-col class="row-add">
                        <ion-button (click)="addRow()">
                          <ion-icon
                            name="add-circle-outline"
                            size="large"
                            slot="icon-only"
                          ></ion-icon>
                        </ion-button>
                      </ion-col>
                    </ion-row>
                  </ion-item>
                  <ion-item size-xs="12" size-sm="1" lines="none">
                    <ion-button class="update" (click)="removeRow(i)">
                      <ion-icon
                        name="remove-circle-outline"
                        size="large"
                        slot="icon-only"
                      ></ion-icon>
                    </ion-button>
                  </ion-item>
                  <ion-col size-xs="12" size-sm="">
                    <select
                      class="select-class"
                      formControlName="param1"
                      [ngClass]="(!allSearch().controls[i].get('param1').valid && submitted) ? 'error' : ''"
                      (change)="onParam1Change(i)"
                      onchange=""
                    >
                      <option class="select-options" value="select" selected>
                        select
                      </option>
                      <option
                        class="select-options"
                        [value]="param1?.id"
                        *ngFor="let param1 of searchData; let i= index"
                      >
                        {{param1?.name}}
                      </option>
                    </select>
                  </ion-col>
                  <ion-col size-xs="12" size-sm="">
                    <select
                      class="select-class"
                      [attr.disabled]="isParam2Select? '':null"
                      formControlName="param2"
                      onselect=""
                      (change)="onParam2Change(i)"
                      [ngClass]="!allSearch().controls[i].get('param2')?.valid && submitted ? 'error' : ''"
                    >
                      <option
                        class="select-options"
                        [value]="p2.id"
                        *ngFor="let p2  of param2List[i];"
                      >
                        {{p2.name}}
                      </option>
                    </select>
                  </ion-col>
                  <ion-col size-xs="12" size-sm="" class="input-wrapper">
                    <ion-input
                      clearInput
                      type="text"
                      class="input-box"
                      formControlName="param3"
                      (focusout)="getValue($event, i)"
                      [ngClass]="!allSearch().controls[i].get('param3')?.valid && submitted ? 'error' : ''"
                      *ngIf="!isDateType(i) else dates"
                    >
                    </ion-input>

                    <ng-template #dates>
                      <ion-input
                        clearInput
                        class="input-box range"
                        formControlName="param3"
                        [ngClass]="!allSearch().controls[i].get('param3')?.valid && submitted ? 'error' : ''"
                        *ngIf="allSearch().controls[i].get('param2')?.value === 'BETWEEN'"
                        id="{{'datepicker' + i}}"
                      >
                      </ion-input>

                      <ion-input
                        clearInput
                        type="date"
                        class="input-box"
                        formControlName="param3"
                        [ngClass]="!allSearch().controls[i].get('param3')?.valid && submitted ? 'error' : ''"
                        *ngIf="allSearch().controls[i].get('param2')?.value !== 'BETWEEN'"
                      >
                      </ion-input>
                    </ng-template>
                  </ion-col>
                  <ion-col
                    size-xs="12"
                    size-sm=""
                    class="input"
                    *ngIf="allSearch().controls[i].get('param1')?.value == 'MODIFICATION_DATE'"
                  >
                    <ion-input
                      clearInput
                      type="text"
                      class="input-box"
                      formControlName="param4"
                      [ngClass]="!allSearch().controls[i].get('param4')?.valid && submitted ? 'error' : ''"
                      *ngIf="isDestinationNeeded(i)"
                    >
                    </ion-input>
                  </ion-col>
                </ion-row>
              </ion-grid>
            </div>
          </form>

          <ion-item>
            <ion-row class="btn-group">
              <ion-col size-xs="6" size-sm="6" class="clear-filter">
                <ion-button (click)="clearFilter()" class="clear-btn"
                  >Clear Filter</ion-button
                >
              </ion-col>
              <ion-col size-xs="6" size-sm="6" class="apply-filter">
                <ion-button (click)="applyFilter()" class="apply-btn"
                  >Apply Filter</ion-button
                >
              </ion-col>
            </ion-row>
          </ion-item>

          <ion-item lines="none">
            <ion-row class="save-row ion-align-items-center">
              <ion-col size-xs="12" size-sm="4">
                <ion-input
                  clearInput
                  class="input-box"
                  placeholder="Enter search name"
                  [(ngModel)]="searchParam"
                >
                </ion-input>
              </ion-col>
              <ion-col size-xs="3" size-sm="2" class="save-btn">
                <ion-button
                  *ngIf="!presetSelected"
                  [disabled]="searchParam?.length < 1"
                  (click)="savePreselectForm()"
                  class="save"
                >
                  Save</ion-button
                >
              </ion-col>

              <ion-col size-xs="3" size-sm="2" class="modi-btn">
                <div class="dropdown" *ngIf="presetSelected">
                  <button
                    class="selectbtn btn-primary dropdown-toggle"
                    type="button"
                    id="dropdown"
                    data-bs-toggle="dropdown"
                    aria-expanded="false"
                  >
                    Update
                  </button>
                  <ul class="dropdown-menu" aria-labelledby="dropdown">
                    <li class="dropdown-item" (click)="saveAsNewPreset()">
                      Save As New Preset
                    </li>
                    <li class="dropdown-item" (click)="updateCurrentPreset()">
                      Update Current Preset
                    </li>
                  </ul>
                </div>
              </ion-col>
              <ion-col class="error-col" size-xs="4" size-sm="3">
                <ion-text
                  ><span class="message" id="message"
                    >{{message}}</span
                  ></ion-text
                >
              </ion-col>
              <ion-col size-xs="5" size-sm="3" class="save-btn">
                <ion-button class="delete-preset" (click)="deletePreset()"
                  >Delete Preset</ion-button
                >
              </ion-col>
            </ion-row>
          </ion-item>
        </ion-grid>
      </ion-list>
    </ion-accordion>
  </ion-accordion-group>
  <!-- <ion-icon name="remove-circle-outline"></ion-icon> -->
</ion-content>
